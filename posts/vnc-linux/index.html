<!doctype html><html lang=zh><head><meta charset=UTF-8><meta content="IE=edge" http-equiv=X-UA-Compatible><meta content="text/html; charset=UTF-8" http-equiv=content-type><meta content="width=device-width,initial-scale=1,user-scalable=no" name=viewport><meta content="index, follow" name=robots><title>使用VNC远程连接Linux</title><meta content=使用VNC远程连接Linux name=title><meta content=Dirigo name=author><meta content=使用VNC远程连接Linux name=description><meta content=website property=og:type><meta content=https://linq.github.io/posts/vnc-linux/ property=og:url><meta property=og:site_name><meta content=使用VNC远程连接Linux property=og:title><meta content=使用VNC远程连接Linux property=og:description><meta content=https://linq.github.io/favicon.ico property=og:image><meta content=summary_large_image property=twitter:card><meta content=https://linq.github.io/posts/vnc-linux/ property=twitter:url><meta content=使用VNC远程连接Linux property=twitter:title><meta content=使用VNC远程连接Linux property=twitter:description><meta content=https://linq.github.io/favicon.ico property=twitter:image><link href=https://linq.github.io/posts/vnc-linux/ rel=canonical><link rel="shortcut icon" href=https://linq.github.io/favicon.ico type=image/x-icon><link href=https://linq.github.io/atom.xml rel=alternate title=RSS type=application/atom+xml><link href=https://linq.github.io/css/style.css rel=stylesheet><link href=https://linq.github.io/css/custom.css rel=stylesheet><script defer src=https://linq.github.io/js/script.js></script><body><div class=wrapper><header><nav class=navBar><a href=/> /首页/ </a><a href=/archive> /归档/ </a><a href=/tags> /标签/ </a><a href=/book> /图书/ </a><div class=themeSwitch><button class="themeButton light" onclick="setTheme('light')" title="Light mode"><svg class="icons icons__background"><use href=https://linq.github.io/icons.svg#lightMode></use></svg></button><button class="themeButton dark" onclick="setTheme('dark')" title="Dark mode"><svg class="icons icons__background"><use href=https://linq.github.io/icons.svg#darkMode></use></svg></button></div></nav></header><main><h1>使用VNC远程连接Linux</h1><p><img alt=linux-prompt src=https://linq.github.io/posts/vnc-linux/linux-prompt.webp><p>这周发现查资料用的远程windows server 连不上，其实之前就遇到过一次，貌似是因为window server 对远程登录的账号数量有限制，虽然可以通过修改注册表的方式绕过，但是用个半年就会出问题。<p>这次想着优化下，用 Linux 远程桌面吧，虽然安装折腾点，但是毕竟是一次性成本，装好后就可以长期使用了，算下来还是值得的。<h2 id=debian-an-zhuang-tu-xing-jie-mian-he-vnc-server>Debian 安装图形界面和 VNC server</h2><p>正好阿里云ECS 文档上有教程，就<a href=https://help.aliyun.com/zh/simple-application-server/use-cases/use-vnc-to-build-guis-on-ubuntu-18-04-and-20-04 rel=noopener target=_blank>参考着安装</a>。<h3 id=zhang-hao-zhun-bei>账号准备</h3><p>因为每个 vnc 关联一个登录账号，需要先准备一个登录账号：<pre class=language-bash data-lang=bash style=background:#2b303b;color:#c0c5ce><code class=language-bash data-lang=bash><span style=color:#bf616a>sudo</span><span> adduser myuser
</span><span style=color:#bf616a>sudo</span><span> usermod</span><span style=color:#bf616a> -aG</span><span> sudo myuser
</span><span style=color:#bf616a>getent</span><span> group sudo myuser
</span></code></pre><p>这里创建了一个 myuser，并且添加到 sudo 组中。<h3 id=tu-xing-huan-jing-an-zhuang>图形环境安装</h3><p>因为是远程用，这里安装精简的 xfce 桌面。<pre class=language-bash data-lang=bash style=background:#2b303b;color:#c0c5ce><code class=language-bash data-lang=bash><span style=color:#bf616a>sudo</span><span> apt install xfce4 xfce4-goodies
</span></code></pre><h3 id=vnc-server-an-zhuang-pei-zhi>VNC server 安装配置</h3><p>首先安装 vnc 软件包：<pre class=language-bash data-lang=bash style=background:#2b303b;color:#c0c5ce><code class=language-bash data-lang=bash><span style=color:#bf616a>sudo</span><span> apt install tigervnc-standalone-server tigervnc-common
</span></code></pre><p>然后设置登录密码：<pre class=language-bash data-lang=bash style=background:#2b303b;color:#c0c5ce><code class=language-bash data-lang=bash><span style=color:#bf616a>vncpasswd
</span></code></pre><p>这里会要确认密码选项，选择 n 就可以。<h3 id=pei-zhi-xstartup>配置 xstartup</h3><p>这里麻烦点，官方的教程可能太老了不适用，查了一些资料后终于解决了启动问题。 添加 <code>$HOME/.vnc/xstartup</code>：<pre class=language-bash data-lang=bash style=background:#2b303b;color:#c0c5ce><code class=language-bash data-lang=bash><span style=color:#65737e>#!/bin/sh
</span><span style=color:#b48ead>export </span><span style=color:#bf616a>XKL_XMODMAP_DISABLE</span><span>=</span><span style=color:#a3be8c>1
</span><span style=color:#b48ead>export </span><span style=color:#bf616a>XDG_RUNTIME_DIR</span><span>=</span><span style=color:#a3be8c>/run/user/</span><span>$</span><span style=color:#a3be8c>(</span><span style=color:#bf616a>id -u</span><span style=color:#a3be8c>)
</span><span style=color:#96b5b4>unset</span><span> SESSION_MANAGER
</span><span style=color:#96b5b4>unset</span><span> DBUS_SESSION_BUS_ADDRESS
</span><span>
</span><span style=color:#96b5b4>[ </span><span style=color:#bf616a>-x</span><span> /etc/vnc/xstartup </span><span style=color:#96b5b4>] </span><span>&& </span><span style=color:#96b5b4>exec</span><span> /etc/vnc/xstartup
</span><span style=color:#96b5b4>[ </span><span style=color:#bf616a>-r </span><span>$</span><span style=color:#bf616a>HOME</span><span>/.Xresources </span><span style=color:#96b5b4>] </span><span>&& </span><span style=color:#bf616a>xrdb </span><span>$</span><span style=color:#bf616a>HOME</span><span>/.Xresources
</span><span style=color:#bf616a>startxfce4
</span></code></pre><h3 id=qi-dong-vnc-server>启动 VNC server</h3><p>直接执行以下命令即可启动一个vncserver 实例，如果要长期使用，建议加到 <code>.profile</code> 中间中：<pre class=language-bash data-lang=bash style=background:#2b303b;color:#c0c5ce><code class=language-bash data-lang=bash><span style=color:#b48ead>export </span><span style=color:#bf616a>BROWSER</span><span>=</span><span style=color:#a3be8c>firefox
</span><span style=color:#bf616a>vncserver</span><span> :1</span><span style=color:#bf616a> -geometry</span><span> 1280x720</span><span style=color:#bf616a> -depth</span><span> 24</span><span style=color:#bf616a> -securitytypes</span><span> VncAuth,TLSVnc
</span></code></pre><p>这里设置分辨率 1280x720，可以根据自己的需要调整，不过不建议调太高，尤其是公网访问的情况下，太高的分辨率卡顿很严重，我自己用 1080 试过，几乎卡成PPT 了。<h3 id=an-zhuang-zhong-wen-zi-ti>安装中文字体</h3><p>以上配置好后通过 VNC client 就可以连接上去了，默认启动的是 5900 + server_id 端口，比如第一个 server 就是 5901，通过vnc <code>ip:5901</code> 就可以远程连接使用。<p>不过连上去如果打开中文网站会发现显示乱码，这个是因为没有中文字体支持，所以我们安装下中文字体：<pre class=language-bash data-lang=bash style=background:#2b303b;color:#c0c5ce><code class=language-bash data-lang=bash><span style=color:#bf616a>sudo</span><span> apt install fonts-wqy-zenhei fonts-wqy-microhei xfonts-wqy
</span></code></pre><p>这样差不多就能正常访问了，记得安装firefox 浏览器，当然也可以安装其它的，不过需要记得修改 <code>export BROWSER=firefox</code> 配置，<code>xfce4</code> 默认通过该环境变量来启动浏览器。<h2 id=docker-vnc-linux>Docker VNC Linux</h2><p>上面的配置基本满足了远程Linux 访问需求，稍微有点麻烦的是每个用户登录上去都需要配置下vnc server 相关的配置。就想着都是通过vnc 访问，是否可以直接用docker 容器来启动linux 桌面呢，只要配置好一个docker 镜像，后续每个用户只要启动自己的容器即可。按照这个思路在Google 上搜了下还真现成的镜像 <a href=https://github.com/edgelevel/alpine-xfce-vnc rel=noopener target=_blank>alpine-xfce-vnc</a>。<p>这里贴下使用方式：<pre class=language-bash data-lang=bash style=background:#2b303b;color:#c0c5ce><code class=language-bash data-lang=bash><span style=color:#65737e># pull latest image
</span><span style=color:#bf616a>docker</span><span> run</span><span style=color:#bf616a> --rm </span><span>\
</span><span style=color:#bf616a>  -p</span><span> 5900:5900</span><span style=color:#bf616a> -p</span><span> 6080:6080 \
</span><span style=color:#bf616a>  --name</span><span> alpine-xfce-vnc \
</span><span style=color:#bf616a>  --hostname</span><span> alpine \
</span><span>  edgelevel/alpine-xfce-vnc
</span></code></pre><p>可以看到使用非常的方便，一个docker 命令搞定，而且启动非常的快。支持 VNC 和 noVNC 两种方式访问。<p><img alt=tigervnc src=https://linq.github.io/posts/vnc-linux/tigervnc.webp><p>这个docker 镜像是基于alpine 制作的，对于中文乱码，打开终端安装中文字体即可解决：<pre class=language-bash data-lang=bash style=background:#2b303b;color:#c0c5ce><code class=language-bash data-lang=bash><span style=color:#bf616a>apk</span><span> add font-wqy-zenhei
</span></code></pre><h2 id=shi-yong-docker-firefox>使用 docker-firefox</h2><p>上面docker 的方案已经很方便了，但是个人稍微有点强迫症，感觉linux 中除了浏览器其它的软件都不需要，尤其是状态栏，壁纸相关，不仅占空间而且会额外影响vnc 的传输效率。基本想法是也不需要安装 <code>xfce4</code> 桌面了，直接安装一个浏览器就可以。然后找到了 <a href=https://github.com/jlesage/docker-firefox rel=noopener target=_blank>docker-firefox</a> 项目。<p>该项目其实跟上面的 docker vnc linux 方案差别不大，只是没有安装完整的桌面，使用了精简的 <code>icewm</code>，整个容器启动后就是一个浏览器的桌面，非常的简洁。<p>启动命令：<pre class=language-bash data-lang=bash style=background:#2b303b;color:#c0c5ce><code class=language-bash data-lang=bash><span style=color:#bf616a>docker</span><span> run</span><span style=color:#bf616a> -d </span><span>\
</span><span style=color:#bf616a>    --name</span><span>=firefox \
</span><span style=color:#bf616a>    -p</span><span> 5800:5800 \
</span><span style=color:#bf616a>    -v</span><span> /docker/appdata/firefox:/config:rw \
</span><span>    jlesage/firefox
</span></code></pre><p>这里面还有挺多参数可以配置，包括语言、分辨率还有字体等，如果想开箱即用可以用如下命令启动：<pre class=language-bash data-lang=bash style=background:#2b303b;color:#c0c5ce><code class=language-bash data-lang=bash><span style=color:#bf616a>docker</span><span> run</span><span style=color:#bf616a> -d </span><span>\
</span><span style=color:#bf616a>    --name</span><span>=firefox \
</span><span style=color:#bf616a>    -e</span><span> DISPLAY_WIDTH=1280 \
</span><span style=color:#bf616a>    -e</span><span> DISPLAY_HEIGHT=900 \
</span><span style=color:#bf616a>    -e</span><span> LANG=zh_CN.UTF-8 \
</span><span style=color:#bf616a>    -e</span><span> TZ=Asia/Shanghai \
</span><span style=color:#bf616a>    -e</span><span> ENABLE_CJK_FONT=1 \
</span><span style=color:#bf616a>    -p</span><span> 5800:5800 \
</span><span style=color:#bf616a>    -p</span><span> 5900:5900 \
</span><span style=color:#bf616a>    -v </span><span>`</span><span style=color:#bf616a>pwd</span><span>`/firefox:/config:rw \
</span><span>    jlesage/firefox
</span></code></pre><p><img alt=docker-firefox src=https://linq.github.io/posts/vnc-linux/docker-firefox.webp> <code>ip:5800</code> 通过浏览器 <code>noVNC</code> 访问，<code>ip:5900</code> 通过vnc client 访问，推荐通过client 的方式访问，浏览器快捷键操作容器不小心就退出了。<p>这里有个问题没有解决，系统剪切板共享中文的时候是乱码，<code>GitHub</code> 上搜了下也没看到解决方案，后续再研究看看。<p class=tagsData><a href=/tags/ji-zhu>/技术/</a> <a href=/tags/vnc>/VNC/</a> <a href=/tags/linux>/Linux/</a> <a href=/tags/docker>/Docker/</a></main><footer><hr><div class=footContainer><div class=footLeft><p>Licensed under <a rel="noopener noreferrer" href=https://fr.wikipedia.org/wiki/Licence_MIT target=_blank>MIT</a><br> Built with <a rel="noopener noreferrer" href=https://www.getzola.org target=_blank>Zola</a> using <a rel="noopener noreferrer" href=https://github.com/Speyll/anemone target=_blank>anemone</a> theme & <a rel="noopener noreferrer" href=https://github.com/Speyll/veqev target=_blank>veqev</a> colors.<br></div><div class=footRight><a rel="noopener noreferrer" title="Subscribe via RSS for updates." class=icons__background href=https://linq.github.io/atom.xml target=_blank><svg class="icons icons__background"><use href=https://linq.github.io/icons.svg#rss></use></svg></a></div></div></footer></div>